<ion-header class="searchHeader">
    <!-- <ion-toolbar class="resultHead">
        <ion-buttons class="searchBtn" start>
            <button class="search_icon" (click)="show_search()" ion-button icon-only>
                <img src="assets/img/searchIcon.png" alt="">
            </button>
        </ion-buttons>
        <div class="searchFiels" [ngClass]="show_search_field ? 'active':''">
            <form (ngSubmit)="load_search_results()" name="login_form">
                <input type="text" [(ngModel)]="search_term" class="searchTxt" name="search" placeholder="Search">
            </form>
            <img class="icon" src="assets/img/closeIconGray.svg" alt="">
        </div>
        <ion-title *ngIf="hide_header_contents == false">
            <div class="dots_box">
                <span class="un_active_dot"></span>
                <span class="dot"></span>
            </div>
        </ion-title>
    </ion-toolbar> -->
    <ion-toolbar color="homeheader">
        <div class="search_header">
            <span [ngClass]="filter_mode?'activeOption':''" class="options" (click)="show_filters()"></span>
            <img src="assets/img/searchIcon.png" alt="" />
            <form (ngSubmit)="load_search_results()" name="login_form">
                <input search-field id="search_field_id" name="search" class="search_field" [(ngModel)]="search_term" type="text" placeholder="Search or enter address" />
            </form>
            <span (click)="clear()" class="clear_button"></span>
        </div>
    </ion-toolbar>
</ion-header>
<span navPop class="wedge_icon"></span>
<ion-content class="searchPage" [ngClass]="{'filtersShown': filter_mode}" swipe-vertical>
    <ion-list *ngIf="filter_mode" class="filterMode" no-bounce>
        <div class="mediaMode">
            <h4>Media</h4>
            <ul>
                <li (click)="anotote_or_user_filter('tote')">
                    <h4 [ngClass]="{'selected': search_filters.media.tote}">Totes</h4>
                </li>
                <li (click)="anotote_or_user_filter('user')">
                    <h4 [ngClass]="{'selected': search_filters.media.user}">Users</h4>
                </li>
                <li (click)="anotote_or_user_filter('chat')">
                    <h4 [ngClass]="{'selected': search_filters.media.chat}">Chats</h4>
                </li>
            </ul>
        </div>
        <div class="catMode" *ngIf="search_filters.media.user == false && search_filters.media.chat == false">
            <h4>Category</h4>
            <ul>
                <li [ngClass]="{'active': search_filters.category.me == true}" (click)="category_filter('me')">
                    <span>Me</span>
                </li>
                <li [ngClass]="{'active': search_filters.category.follows == true}" (click)="category_filter('follows')">
                    <span>Follows</span>
                </li>
                <li [ngClass]="{'active': search_filters.category.top == true}" (click)="category_filter('top')">
                    <span>Top</span>
                </li>
            </ul>
        </div>
        <div class="dateMode" *ngIf="search_filters.media.user == false && search_filters.media.chat == false">
            <h4>Date</h4>
            <ul>
                <li>
                    <input type="number" [(ngModel)]="search_filters.date.year" name="year" placeholder="YYYY">
                </li>
                <li>
                    <input type="number" [(ngModel)]="search_filters.date.month" name="month" placeholder="MM">
                </li>
                <li>
                    <input type="number" [(ngModel)]="search_filters.date.day" name="day" placeholder="DD">
                </li>
            </ul>
        </div>
    </ion-list>
    <div class="search-panel" *ngIf="!filter_mode">
        <div *ngIf="_loading" class="_spinner">
            <ion-spinner name="ios"></ion-spinner>
        </div>
        <div class="no_search" *ngIf="no_search == true">
            <p>No results</p>
        </div>
        <ion-list class="search-result">
            <ion-item *ngFor="let anotote of search_results; let i = index">
                <div [ngClass]="{'activeTote' : current_active_anotote==anotote }" (click)="openAnototeDetail(anotote)" *ngIf="anotote.is_tote == true || anotote.isChat == true">
                    <div class="img-holder" (click)="presentAnototeOptionsModal($event,anotote)">
                    </div>
                    <div class="txt txtMiddel" [ngClass]="{'txtToto': edit_mode == true, 'forFollower':anotote.userAnnotote.isMe == 0 && anotote.userAnnotote.isTop == 0}" *ngIf="anotote.is_tote == true">
                        <p *ngIf="anotote.userAnnotote.isMe == 0 && anotote.userAnnotote.isTop == 0">{{anotote.selected_follower_name}}
                            <ng-container *ngIf="anotote.userAnnotote.follows.length > 2">+ {{anotote.userAnnotote.follows.length - 1}} others</ng-container>
                            <ng-container *ngIf="anotote.userAnnotote.follows.length == 2">+ {{anotote.userAnnotote.follows.length - 1}} other</ng-container>
                        </p>
                        <strong [ngClass]="{'opened': anotote.active}" [innerText]="anotote.userAnnotote.userAnnotote.annototeTitle"></strong>
                        <div class="time">
                            <em>
                                <span [innerText]="anotote.userAnnotote.userAnnotote.createdAt | time_stamp"></span>
                            </em>
                        </div>
                        <div class="toteText">
                            <p [innerText]="anotote.userAnnotote.annotote.source"></p>
                            <button type="button">
                                <!-- <img src="assets/img/lineIcon.svg" alt=""> -->
                                <ion-icon name="menu"></ion-icon>
                            </button>
                        </div>
                    </div>
                    <div class="txt" *ngIf="anotote.isChat == true">
                        <!-- <ng-container *ngIf="current_color == 'me'">
                            <img class="unReadLock" *ngIf="anotote.chatGroup.messagesUser[anotote.chatGroup.messagesUser.length - 1].read == 0 && anotote.chatGroup.messagesUser[anotote.chatGroup.messagesUser.length - 1].senderId != user.id" src="assets/img/redLock.svg" alt="">
                        </ng-container> -->
                        <ng-container *ngIf="anotote.chatGroup.messagesUser != null && anotote.chatGroup.messagesUser[0].anototeId == 0">
                            <strong *ngIf="anotote.chatGroup.messagesUser[0].subject == null">Chat</strong>
                            <strong *ngIf="anotote.chatGroup.messagesUser[0].subject != null">Chat: {{anotote.chatGroup.messagesUser[0].subject}}</strong>
                        </ng-container>
                        <ng-container *ngIf="anotote.chatGroup.messagesUser != null && anotote.chatGroup.messagesUser[0].anototeId != 0">
                            <strong>Chat: {{anotote.chatGroup.messagesUser[0].subject}}</strong>
                        </ng-container>
                        <div class="time">
                            <em>
                                <span [innerText]="anotote.chatGroup.createdAt | time_stamp"></span>
                            </em>
                        </div>
                        <div class="toteText">
                            <p *ngIf="anotote.chatGroup.groupUsers[0].user.id != user.id" (click)="chat_participants_from_tote($event,anotote)">{{anotote.chatGroup.groupUsers[0].user.firstName}} ({{anotote.chatGroup.groupUsers.length}})</p>
                            <p *ngIf="anotote.chatGroup.groupUsers[1].user.id != user.id" (click)="chat_participants_from_tote($event,anotote)">{{anotote.chatGroup.groupUsers[1].user.firstName}} ({{anotote.chatGroup.groupUsers.length}})</p>
                            <!-- <ng-container *ngIf="current_color == 'follows'">
                                <p (click)="chat_participants_from_tote($event,anotote)">{{anotote.chatGroup.groupUsers[0].user.firstName}}
                                    <ng-container>({{anotote.chatGroup.groupUsers.length}})</ng-container>
                                </p>
                            </ng-container> -->
                            <button type="button">
                                <img src="assets/img/commentIcon.svg" alt="">
                                <img class="unReadMsg" src="assets/img/redMessage.svg" alt="">
                            </button>
                        </div>
                    </div>
                </div>
                <!-- anatote detail  (press)="enable_list_reorder(anotote)"-->
                <div class="toteActive" [ngClass]="{'toteTransition': anotote.active}" *ngIf="anotote.is_tote == true">
                    <div class="loading" [hidden]="anotote.userAnnotote.spinner_for_active == false">
                        <ion-spinner></ion-spinner>
                    </div>
                    <header class="listHeader" [hidden]="anotote.userAnnotote.spinner_for_active == true">
                        <div class="underlist-text">
                            <div class="btns-area">
                                <button ion-button *ngIf="anotote.userAnnotote.isMe == 1" (click)="showMeHighlights(anotote.userAnnotote)" class="me-tab" [ngClass]="{'active_me': anotote.userAnnotote.active_tab == 'me'}">Me</button>
                                <!-- <button class="me-tab active_follows" ion-button *ngIf="anotote.userAnnotote.isMe == 0 && anotote.userAnnotote.isTop == 0">{{anotote.selected_follower_name}}</button> -->
                                <button (click)="follows_popup($event,anotote.userAnnotote)" ion-button class="me-tab" [ngClass]="{'active_follows': anotote.userAnnotote.active_tab == 'follows'}" *ngIf="anotote.userAnnotote.follows.length > 0">{{anotote.userAnnotote.selected_follower_name}}
                                    <i *ngIf="anotote.userAnnotote.follows.length > 1">({{anotote.userAnnotote.follows.length}})</i>
                                </button>
                                <button ion-button class="me-tab" [ngClass]="{'active_top': anotote.userAnnotote.active_tab == 'top'}" *ngIf="anotote.userAnnotote.isTop == 1" (click)="show_top_tab(anotote.userAnnotote)">Top</button>
                            </div>
                        </div>
                    </header>
                    <div class="quotes layout message-underlist" [hidden]="anotote.userAnnotote.spinner_for_active == true">
                        <ion-list no-lines class="details-list layout" *ngIf="anotote.userAnnotote.highlights.length > 0">
                            <ng-container *ngFor="let highlight of anotote.userAnnotote.highlights">
                                <ion-item (click)="go_to_browser(anotote,highlight)" *ngIf="highlight.deleted != 1" class="underlist-items">
                                    <div class="txt">
                                        <p>{{highlight.highlightText}}</p>
                                        <p class="lightText" *ngIf="highlight.comment != null && highlight.comment != '' && (highlight.edit == undefined || highlight.edit == false)">{{highlight.comment}}</p>
                                        <!-- <div class="tagImage" *ngIf="highlight.tags.length > 0 && (highlight.edit == undefined || highlight.edit == false)" (click)="show_tags_for_annotation($event,anotote.active_tab,highlight)">
                                            <img src="assets/img/dotsicon.svg" alt="">
                                        </div> -->
                                    </div>

                                    <span class="status quoteStatus" [ngClass]="{'quotes_follows':  anotote.userAnnotote.active_tab == 'follows','quotes_top':  anotote.userAnnotote.active_tab == 'top'}" *ngIf="highlight.comment == null || highlight.comment == ''">
                                        <img src="assets/img/quoteImg.svg" alt="">
                                    </span>
                                    <span class="status" [ngClass]="{'quotes_follows':  anotote.userAnnotote.active_tab == 'follows','quotes_top':  anotote.userAnnotote.active_tab == 'top'}" *ngIf="highlight.comment != null && highlight.comment != ''">
                                        <img src="assets/img/commentImg.svg" alt="">
                                    </span>
                                </ion-item>
                            </ng-container>
                        </ion-list>
                        <div class="no_anotation" *ngIf="anotote.userAnnotote.highlights.length == 0">
                            <p>No anotations created yet.</p>
                        </div>
                    </div>
                </div>
                <!-- Message detail -->
                <div class="toteActive" (tap)="go_to_chat_thread(anotote)" [ngClass]="{'toteTransition': anotote.active && anotote.isChat == true}" *ngIf="anotote.isChat">
                    <div class="quotes layout message-underlist">
                        <ion-list no-lines class="details-list layout" [hidden]="anotote.spinner_for_active == true">
                            <ion-item class="underlist-items" (press)="presentMessageOptions(message,anotote)" *ngFor="let message of anotote.chatGroup.messagesUser">
                                <figure>
                                    <!-- <img [src]="message | chatHeads" alt=""> -->
                                    <ng-container *ngIf="(anotote.chatGroup.groupUsers | chatVoteOptions) == true">
                                        <img *ngIf="message.senderId == user.id" src="assets/img/check-green.png" alt="">
                                        <img *ngIf="message.senderId != user.id && message.read == 0" src="assets/img/check-red.png" alt="">
                                        <img *ngIf="message.senderId != user.id && message.read == 1" src="assets/img/checkYellow.png" alt="">
                                    </ng-container>
                                    <ng-container *ngIf="(anotote.chatGroup.groupUsers | chatVoteOptions) == false">
                                        <img *ngIf="message.senderId == user.id" src="assets/img/check-green.png" alt="">
                                        <img *ngIf="message.senderId != user.id" src="assets/img/checkYellow.png" alt="">
                                    </ng-container>

                                </figure>
                                <div class="check-text">
                                    <div class="name-time">
                                        <span class="user" *ngIf="message.senderId == user.id">Me</span>
                                        <span class="user" *ngIf="message.senderId != user.id">{{anotote.chatGroup.groupUsers | chat_name}}</span>
                                        <span class="msg-time">{{message.createdAt | time_stamp}}</span>
                                    </div>
                                    <p [ngStyle]="{'color': 'red'}" *ngIf="message.read == 0 && user.id != message.senderId && current_color == 'me'">{{message.text}}</p>
                                    <p *ngIf="message.read == 0 && user.id != message.senderId && current_color != 'me'">{{message.text}}</p>
                                    <p *ngIf="message.read != 0 && user.id != message.senderId">{{message.text}}</p>
                                    <p *ngIf="user.id == message.senderId">{{message.text}}</p>
                                    <!-- <img src="assets/img/option-msg.png" alt=""> -->
                                </div>
                            </ion-item>
                        </ion-list>
                    </div>
                </div>
                <!-- User -->
                <li *ngIf="anotote.is_tote == false && anotote.isChat == false" (click)="showProfile(anotote)">
                    <figure>
                        <img *ngIf="anotote.photo== null || anotote.photo==''" src="assets/img/userGray.svg">
                        <img (load)="loaded = true" [ngClass]="{'img-loaded': loaded}" *ngIf="anotote.photo != null && anotote.photo != ''" [hidden]="!loaded" [src]="anotote.photo | image_base_path">
                        <ion-spinner *ngIf="!loaded && anotote.photo != null && anotote.photo != ''"></ion-spinner>
                    </figure>
                    <figcaption>
                        <!-- <h4>Search result {{i+1}}</h4>
                        <span>{{anotote.firstName}}
                            <i *ngIf="anotote.isFollowed == 1">
                                <</i>
                                    <b>
                                        <ion-icon *ngIf="anotote.isFollowed == 0" (click)="followUser($event,search_result)" name="add"></ion-icon>
                                        <i *ngIf="anotote.isFollowed == 1">@</i>
                                    </b>
                        </span>
                        <span class="excerptTxt">{{anotote.description}}</span> -->
                        <h4>{{anotote.firstName}}
                            <img *ngIf="anotote.isFollowed == 1" class="star-icon" src="assets/img/star-gray.png" alt="">
                        </h4>
                        <span class="rightAdd" *ngIf="anotote.isFollowed == 0 && anotote.follow_loading == false" (click)="followUser($event,anotote)">FOLLOW</span>
                        <span class="rightAdd" *ngIf="anotote.follow_loading == true">
                            <ion-spinner name="bubbles"></ion-spinner>
                        </span>
                    </figcaption>
                </li>
            </ion-item>
        </ion-list>
    </div>
    <ion-fab bottom [ngClass]="{'moveUpList': move_fab == true || forFollowedCaseName == true}" right>
        <button (tap)="presentViewOptionsModal()" ion-fab [color]="current_active_anotote == null ? 'anon' : (current_active_anotote.chatGroup != null ? current_active_anotote.active_tab:current_active_anotote.userAnnotote.active_tab)">
            <img *ngIf="current_active_anotote == null || current_color == 'anon'" src="assets/img/whiteFab.svg" />
            <ng-container *ngIf="current_active_anotote != null && current_active_anotote.chatGroup == null">
                <img *ngIf="current_active_anotote != null &&  current_active_anotote.userAnnotote.active_tab == 'me' && current_active_anotote.userAnnotote.follows.length > 0 && current_active_anotote.userAnnotote.isTop == 1" src="assets/img/greenFab1.svg" />
                <img *ngIf="current_active_anotote != null &&  current_active_anotote.userAnnotote.active_tab == 'me' && current_active_anotote.userAnnotote.follows.length > 0 && current_active_anotote.userAnnotote.isTop == 0" src="assets/img/greenFab2.svg" />
                <img *ngIf="current_active_anotote != null &&  current_active_anotote.userAnnotote.active_tab == 'me' && current_active_anotote.userAnnotote.follows.length == 0 && current_active_anotote.userAnnotote.isTop == 1" src="assets/img/greenFab3.svg" />
                <img *ngIf="current_active_anotote != null &&  current_active_anotote.userAnnotote.active_tab == 'me' && current_active_anotote.userAnnotote.follows.length == 0 && current_active_anotote.userAnnotote.isTop == 0" src="assets/img/greenFab4.svg" />
                <!-- Active tab follows -->
                <img *ngIf="current_active_anotote != null && current_active_anotote.userAnnotote.active_tab == 'follows' && current_active_anotote.userAnnotote.isMe == 1 && current_active_anotote.userAnnotote.isTop == 1" src="assets/img/yellowFab1.svg" />
                <img *ngIf="current_active_anotote != null && current_active_anotote.userAnnotote.active_tab == 'follows' && current_active_anotote.userAnnotote.isMe == 1 && current_active_anotote.userAnnotote.isTop == 0" src="assets/img/yellowFab2.svg" />
                <img *ngIf="current_active_anotote != null && current_active_anotote.userAnnotote.active_tab == 'follows' && current_active_anotote.userAnnotote.isMe == 0 && current_active_anotote.userAnnotote.isTop == 1" src="assets/img/yellowFab3.svg" />
                <img *ngIf="current_active_anotote != null && current_active_anotote.userAnnotote.active_tab == 'follows' && current_active_anotote.userAnnotote.isMe == 0 && current_active_anotote.userAnnotote.isTop == 0" src="assets/img/yellowFab4.svg" />
                <!-- Active tab top -->
                <img *ngIf="current_active_anotote != null && current_active_anotote.userAnnotote.active_tab == 'top' && current_active_anotote.userAnnotote.isMe == 1 && current_active_anotote.userAnnotote.follows.length > 0" src="assets/img/pinkFab1.svg" />
                <img *ngIf="current_active_anotote != null && current_active_anotote.userAnnotote.active_tab == 'top' && current_active_anotote.userAnnotote.isMe == 0 && current_active_anotote.userAnnotote.follows.length > 0" src="assets/img/pinkFab2.svg" />
                <img *ngIf="current_active_anotote != null && current_active_anotote.userAnnotote.active_tab == 'top' && current_active_anotote.userAnnotote.isMe == 1 && current_active_anotote.userAnnotote.follows.length == 0" src="assets/img/pinkFab3.svg" />
                <img *ngIf="current_active_anotote != null && current_active_anotote.userAnnotote.active_tab == 'top' && current_active_anotote.userAnnotote.isMe == 0 && current_active_anotote.userAnnotote.follows.length == 0" src="assets/img/pinkFab4.svg" />
            </ng-container>
            <ng-container *ngIf="current_active_anotote != null && current_active_anotote.chatGroup != null">
                <img src="assets/img/greenFab4.svg" />
            </ng-container>
        </button>
        <button *ngIf="unread_notification_count > 0" ion-button icon-only class="notices">{{unread_notification_count}}</button>
    </ion-fab>
</ion-content>